<!-- Portfolio bar -->
<p-toolbar class="portfolio-bar">
    <ng-template #start>
        @if (isLoading()) {
        <app-ui-loader></app-ui-loader>
        }
        @for (item of portfolio(); track $index) {
        <p-chip [class.selected]="portfolioSelected()?.id === item.id" [label]="item.name" icon="pi pi-wallet"
            (click)="onPortfolioSelected(item)" />
        }
        <p-button aria-label="Add" icon="pi pi-plus" [rounded]="true" [raised]="true" severity="contrast" size="large"
            (click)="onAddClicked()" />
    </ng-template>
    <ng-template #center></ng-template>
    <ng-template #end></ng-template>
</p-toolbar>
<!-- main top portfolio panel -->
<p-toolbar class="main-top-bar">
    <ng-template #start>
        <div class="main-numbers-panel">
            <span>Total Value</span>
            <span>Gain/Loss %</span>
            <span>Best Performer</span>
        </div>
    </ng-template>
    <ng-template #center>

    </ng-template>
    <ng-template #end>
        <p-button class="add-holding" severity="info" label="Add Holding" icon="pi pi-plus"
            (click)="onHoldingAddClicked()" />
    </ng-template>
</p-toolbar>
<!-- main content panel -->
<p-toolbar class="main-content-bar">
    <ng-template #start>
        <div class="charts-container">
            <div class="chart-row">
                <p-card header="Holdings (fake data)">
                    <p-chart type="pie" [data]="pieData" [options]="options" />
                </p-card>
                <p-card header="Sectors (fake data)">
                    <p-chart type="pie" [data]="pieData" [options]="options" />
                </p-card>
            </div>
            <div class="chart-row">
                <p-card header="Portfolio History (fake data)">
                    <p-chart type="line" [data]="lineData" />
                </p-card>
            </div>
        </div>
    </ng-template>
    <ng-template #center>
    </ng-template>
    <ng-template #end>
        <p-card class="holding-card" header="Holdings">
            @if (isHoldingsLoading()) {
            <app-ui-loader></app-ui-loader>
            } @else {
            <p-table [value]="holdings()">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Ticker</th>
                        <th>Shares</th>
                        <th>Avg Price</th>
                        <th>Value</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-stock>
                    <tr>
                        <td>{{ stock.ticker }}</td>
                        <td>{{ stock.shares }}</td>
                        <td>{{ stock.avgPrice | currency }}</td>
                        <td>{{ stock.value | currency }}</td>
                    </tr>
                </ng-template>
            </p-table>
            }
        </p-card>
    </ng-template>
</p-toolbar>

<!-- Create Porfolio dialog -->
<p-dialog header="Create Porfolio" [modal]="true" [(visible)]="portfolioDialogVisible"
    [style]="{ width: '30rem', height: '20rem' }">
    <ng-container [formGroup]="portfolioForm">
        <p-iftalabel>
            <input pInputText id="name" formControlName="name" />
            <label for="name">Porfolio Name</label>
        </p-iftalabel>
    </ng-container>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onPortfolioCancelClicked()" />
            <p-button class="save-button" label="Save" (click)="onPortfolioSaveClicked()"
                [disabled]="!portfolioForm.valid" />
        </div>
    </ng-template>
</p-dialog>

<!-- Add Holding dialog -->
<p-dialog class="add-holding-dialog" header="Add Holding" [modal]="true" [(visible)]="holdingDialogVisible"
    [style]="{ width: '40rem', height: '35rem' }">
    <ng-container [formGroup]="holdingForm">
        <p-iftalabel>
            <input pInputText id="ticker" formControlName="ticker" />
            <label for="ticker">Ticker</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-inputnumber inputId="shares" formControlName="shares" mode="decimal" [minFractionDigits]="2"
                [maxFractionDigits]="5" />
            <label for="shares">Shares</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-datepicker id="dateOfPurchase" formControlName="dateOfPurchase" appendTo="body" />
            <label for="dateOfPurchase">Date of Purchase</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-inputnumber inputId="price" formControlName="price" mode="decimal" [minFractionDigits]="2"
                [maxFractionDigits]="5" />
            <label for="price">Price</label>
        </p-iftalabel>
    </ng-container>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onHoldingCancelClicked()" />
            <p-button class="save-button" label="Save" (click)="onHoldingSaveClicked()"
                [disabled]="!holdingForm.valid" />
        </div>
    </ng-template>
</p-dialog>