<!-- portfolio bar -->
<app-portfolio-bar></app-portfolio-bar>
<!-- main top portfolio panel -->
<app-main-top-bar></app-main-top-bar>
<!-- main content panel -->
<p-toolbar class="main-content-bar">
    <!-- charts container -->
    <ng-template #start>
        <div class="charts-container">
            <p-card class="shares-type" header="Types of Shares">
                @if (isHoldingsLoading()) {
                <p-skeleton styleClass="mb-2" />
                } @else {
                <p-metergroup [value]="shareTypes()" />
                }
            </p-card>
            <div class="chart-row">
                <p-card header="Holdings by Amount($) and Percentage">
                    @if (isHoldingsLoading()) {
                    <p-skeleton shape="circle" size="360px" />
                    } @else {
                    <p-chart type="pie" [data]="pieChartHoldingsByAmount()" [options]="pieChartOptions" />
                    }
                </p-card>
                <p-card header="Holdings by Sector">
                    @if (isHoldingsLoading()) {
                    <p-skeleton shape="circle" size="360px" />
                    } @else {
                    <p-chart type="pie" [data]="pieChartHoldingsBySector()" [options]="pieChartOptions" />
                    }
                </p-card>
            </div>
        </div>
    </ng-template>
    <ng-template #center>
    </ng-template>
    <!-- holdings container -->
    <ng-template #end>
        <p-card class="holding-card" header="Holdings">
            @if (isHoldingsLoading()) {
            <p-skeleton width="100%" height="3rem" />
            } @else {
            <p-table [value]="holdings()" size="small" stripedRows [scrollable]="true" scrollHeight="100%"
                [resizableColumns]="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="ticker">Ticker<p-sortIcon field="ticker" /></th>
                        <th pSortableColumn="shares">Shares<p-sortIcon field="shares" /></th>
                        <th pTooltip="Average Price" tooltipPosition="left" pSortableColumn="avgPrice">Avg
                            Price<p-sortIcon field="avgPrice" /></th>
                        <th pTooltip="Number of Transactions" tooltipPosition="left" pSortableColumn="transactions">#
                            Tx<p-sortIcon field="transactions" /></th>
                        <th pTooltip="Edit Contributions" tooltipPosition="left">Edit</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-stock>
                    <tr>
                        <td [pTooltip]="stock.name" tooltipPosition="top">
                            <img class="stock-image" [src]="stock.imgSource" alt=""
                                onerror="this.style.display='none'" />
                            {{ stock.name | slice:0:20 }} @if (stock.name?.length > 20) { ... } ({{ stock.ticker }})
                        </td>
                        <td>{{ stock.shares }}</td>
                        <td>{{ stock.avgPrice | currency }}</td>
                        <td>{{ stock.transactions }}</td>
                        <td><p-button aria-label="Update Contributions" icon="pi pi-file-edit"
                                pTooltip="Update Contributions" tooltipPosition="left" [rounded]="true" [raised]="true"
                                severity="info" size="large" (click)="onEditHoldingClicked(stock)" />
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            }
        </p-card>
    </ng-template>
</p-toolbar>

<!-- create portfolio dialog -->
<app-create-portfolio-dialog></app-create-portfolio-dialog>

<!-- register purchase dialog -->
<app-register-purchase></app-register-purchase>

<!-- delete portfolio dialog -->
<app-delete-portfolio></app-delete-portfolio>

<!-- edit ticker contributions dialog -->
<p-dialog class="edit-portfolio" header="Update Contributions" [modal]="true" [(visible)]="showEditHoldingDialog"
    [style]="{ width: '100rem', height: '55rem' }" (onHide)="onEditHoldingCancel()">
    <p-card class="edit-holding-card">
        <p-table [value]="selectedHoldings()" size="small" stripedRows sortField="dateOfPurchase" [sortOrder]="-1"
            [scrollable]="true" scrollHeight="300px">
            <ng-template pTemplate="header">
                <tr>
                    <th>Ticker</th>
                    <th pSortableColumn="shares">Shares<p-sortIcon field="shares" /></th>
                    <th pSortableColumn="price">Price<p-sortIcon field="price" /></th>
                    <th pSortableColumn="dateOfPurchase">Date of Purchase<p-sortIcon field="dateOfPurchase" /></th>
                    <th pSortableColumn="notes">Notes<p-sortIcon field="notes" /></th>
                    <th>Edit Contributions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-stock>
                <tr>
                    <td [pTooltip]="stock.name" tooltipPosition="top">
                        {{ stock.name | slice:0:20 }} @if (stock.name?.length > 20) { ... } ({{ stock.ticker }})
                    </td>
                    <td>{{ stock.shares }}</td>
                    <td>{{ stock.price | currency }}</td>
                    <td>{{ stock.dateOfPurchase | date: 'MM/dd/yyyy' }}</td>
                    <td [pTooltip]="stock.notes" tooltipPosition="top">
                        {{ stock.notes | slice:0:30 }}
                        @if (stock.notes?.length > 30) { ... }
                    </td>
                    <td><p-button aria-label="Update Contribution" icon="pi pi-file-edit" pTooltip="Update Contribution"
                            tooltipPosition="left" [rounded]="true" [raised]="true" severity="info" size="large"
                            (click)="onEditHoldingItemClicked(stock)" />
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>
    <ng-container [formGroup]="editHoldingItemForm">
        <div class="edit-form">
            <p-iftalabel>
                <input pInputText id="ticker" formControlName="ticker" />
                <label for="ticker">Ticker</label>
            </p-iftalabel>
            <p-iftalabel>
                <p-inputnumber inputId="shares" formControlName="shares" mode="decimal" [minFractionDigits]="2"
                    [maxFractionDigits]="5" />
                <label for="shares">Shares</label>
            </p-iftalabel>
            <p-iftalabel>
                <p-datepicker id="dateOfPurchase" formControlName="dateOfPurchase" appendTo="body" />
                <label for="dateOfPurchase">Date of Purchase</label>
            </p-iftalabel>
            <p-iftalabel>
                <p-inputnumber inputId="price" formControlName="price" mode="decimal" [minFractionDigits]="2"
                    [maxFractionDigits]="5" />
                <label for="price">Price</label>
            </p-iftalabel>
        </div>
        <div class="edit-form">
            <p-iftalabel>
                <textarea rows="2" cols="80" pTextarea formControlName="notes" style="resize: none"></textarea>
                <label for="notes">Notes</label>
            </p-iftalabel>
            <p-button aria-label="Register Sale" severity="warn" label="Register Sale" icon="pi pi-tag"
                pTooltip="Register Sale" tooltipPosition="top" (click)="onTransactionDeleteClicked()"
                [disabled]="!editHoldingItemForm.valid" />
            <p-button aria-label="Save record" severity="success" label="Save Tx" icon="pi pi-save"
                pTooltip="Save Transaction" tooltipPosition="top" [disabled]="!editHoldingItemForm.valid"
                (click)="onTransactionUpdateClicked()" />
        </div>
    </ng-container>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Close" severity="secondary" (click)="onEditHoldingCancel()" />
        </div>
    </ng-template>
</p-dialog>