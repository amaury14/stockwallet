<!-- portfolio bar -->
<p-toolbar class="portfolio-bar">
    <ng-template #start>
        @if (isLoading()) {
        <app-ui-loader></app-ui-loader>
        }
        @for (item of portfolio(); track $index) {
        <p-chip [class.selected]="portfolioSelected()?.id === item.id" [label]="item.name" icon="pi pi-wallet"
            (click)="onPortfolioSelected(item)" />
        }
        <p-button aria-label="Add" icon="pi pi-plus" [rounded]="true" [raised]="true" severity="contrast" size="large"
            (click)="onAddClicked()" />
    </ng-template>
    <ng-template #center></ng-template>
    <ng-template #end></ng-template>
</p-toolbar>
<!-- main top portfolio panel -->
<p-toolbar class="main-top-bar">
    <ng-template #start>
        <div class="main-numbers-panel">
            <span>Total Value</span>
            <span>Gain/Loss %</span>
            <span>Best Performer</span>
        </div>
    </ng-template>
    <ng-template #center>

    </ng-template>
    <ng-template #end>
        <p-button class="delete-portfolio" severity="danger" label="Delete Portfolio" icon="pi pi-trash"
            (click)="onPortfolioDeleteClicked()" [disabled]="!portfolioSelected()" />
        <p-button class="add-holding" severity="info" label="Add Holding" icon="pi pi-plus"
            (click)="onHoldingAddClicked()" [disabled]="!portfolioSelected()" />
    </ng-template>
</p-toolbar>
<!-- main content panel -->
<p-toolbar class="main-content-bar">
    <!-- charts container -->
    <ng-template #start>
        <div class="charts-container">
            <div class="chart-row">
                <p-card header="Holdings (fake data)">
                    <p-chart type="pie" [data]="pieData" [options]="options" />
                </p-card>
                <p-card header="Sectors (fake data)">
                    <p-chart type="pie" [data]="pieData" [options]="options" />
                </p-card>
            </div>
            <div class="chart-row">
                <p-card header="Portfolio History (fake data)">
                    <p-chart type="line" [data]="lineData" />
                </p-card>
            </div>
        </div>
    </ng-template>
    <ng-template #center>
    </ng-template>
    <!-- holdings container -->
    <ng-template #end>
        <p-card class="holding-card" header="Holdings">
            @if (isHoldingsLoading()) {
            <app-ui-loader></app-ui-loader>
            } @else {
            <p-table [value]="holdings()" size="small">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Ticker</th>
                        <th>Shares</th>
                        <th pTooltip="Average Price" tooltipPosition="left">Avg Price</th>
                        <th pTooltip="Transactions" tooltipPosition="left">Tx</th>
                        <th pTooltip="Edit Contributions" tooltipPosition="left">Edit</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-stock>
                    <tr>
                        <td>{{ stock.ticker }}</td>
                        <td>{{ stock.shares }}</td>
                        <td>{{ stock.avgPrice | currency }}</td>
                        <td>{{ stock.transactions }}</td>
                        <td><p-button aria-label="Edit Holding" icon="pi pi-file-edit"
                                pTooltip="Edit Ticker Contributions" tooltipPosition="left" [rounded]="true"
                                [raised]="true" severity="info" size="large" (click)="onEditHoldingClicked(stock)" />
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            }
        </p-card>
    </ng-template>
</p-toolbar>

<!-- create portfolio dialog -->
<p-dialog header="Create Portfolio" [modal]="true" [(visible)]="showPortfolioDialog"
    [style]="{ width: '30rem', height: '20rem' }" (onHide)="onPortfolioCancelClicked()">
    <ng-container [formGroup]="portfolioForm">
        <p-iftalabel>
            <input pInputText id="name" formControlName="name" />
            <label for="name">Porfolio Name</label>
        </p-iftalabel>
    </ng-container>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onPortfolioCancelClicked()" />
            <p-button class="save-button" label="Save" (click)="onPortfolioSaveClicked()"
                [disabled]="!portfolioForm.valid" />
        </div>
    </ng-template>
</p-dialog>

<!-- add holding dialog -->
<p-dialog class="add-holding-dialog" header="Add Holding" [modal]="true" [(visible)]="showHoldingDialog"
    [style]="{ width: '40rem', height: '35rem' }" (onHide)="onHoldingCancelClicked()">
    <ng-container [formGroup]="holdingForm">
        <p-iftalabel>
            <input pInputText id="ticker" formControlName="ticker" />
            <label for="ticker">Ticker</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-inputnumber inputId="shares" formControlName="shares" mode="decimal" [minFractionDigits]="2"
                [maxFractionDigits]="5" />
            <label for="shares">Shares</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-datepicker id="dateOfPurchase" formControlName="dateOfPurchase" appendTo="body" />
            <label for="dateOfPurchase">Date of Purchase</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-inputnumber inputId="price" formControlName="price" mode="decimal" [minFractionDigits]="2"
                [maxFractionDigits]="5" />
            <label for="price">Price</label>
        </p-iftalabel>
    </ng-container>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onHoldingCancelClicked()" />
            <p-button class="save-button" label="Save" (click)="onHoldingSaveClicked()"
                [disabled]="!holdingForm.valid" />
        </div>
    </ng-template>
</p-dialog>

<!-- delete portfolio dialog -->
<p-dialog class="delete-portfolio" header="Delete Portfolio" [modal]="true" [(visible)]="showPortfolioDeleteDialog"
    [style]="{ width: '35rem', height: '22rem' }" (onHide)="onPortfolioDeleteCancelClicked()">
    <p>
        Are you sure you want to delete "{{ portfolioSelected()?.name }}"?
    </p>
    <p>
        There is no going back from this!!!!
    </p>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onPortfolioDeleteCancelClicked()" />
            <p-button class="delete-button"
                [label]="isPortfolioDeleteDisabled() ? 'Wait ' + countdown + 's' : 'Yes, remove it!'" severity="danger"
                [disabled]="isPortfolioDeleteDisabled()" (click)="onPortfolioDeleteOkClicked()" />
        </div>
    </ng-template>
</p-dialog>

<!-- edit ticker contributions dialog -->
<p-dialog class="edit-portfolio" header="Update Contributions" [modal]="true" [(visible)]="showEditHoldingDialog"
    [style]="{ width: '100rem', height: '80rem' }" (onHide)="onEditHoldingCancel()">
    <p-card class="edit-holding-card">
        <p-table [value]="selectedHoldings()" size="small">
            <ng-template pTemplate="header">
                <tr>
                    <th>Ticker</th>
                    <th>Shares</th>
                    <th>Price</th>
                    <th>Date of Purchase</th>
                    <th pTooltip="Edit Contributions" tooltipPosition="top">Edit</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-stock>
                <tr>
                    <td>{{ stock.ticker }}</td>
                    <td>{{ stock.shares }}</td>
                    <td>{{ stock.price | currency }}</td>
                    <td>{{ stock.dateOfPurchase | date: 'MM/dd/yyyy' }}</td>
                    <td><p-button aria-label="Edit Holding" icon="pi pi-file-edit" pTooltip="Edit Ticker Contributions"
                            tooltipPosition="left" [rounded]="true" [raised]="true" severity="info" size="large"
                            (click)="onEditHoldingItemClicked(stock)" />
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>
    <div class="edit-form" [formGroup]="editHoldingItemForm">
        <p-iftalabel>
            <input pInputText id="ticker" formControlName="ticker" />
            <label for="ticker">Ticker</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-inputnumber inputId="shares" formControlName="shares" mode="decimal" [minFractionDigits]="2"
                [maxFractionDigits]="5" />
            <label for="shares">Shares</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-datepicker id="dateOfPurchase" formControlName="dateOfPurchase" appendTo="body" />
            <label for="dateOfPurchase">Date of Purchase</label>
        </p-iftalabel>
        <p-iftalabel>
            <p-inputnumber inputId="price" formControlName="price" mode="decimal" [minFractionDigits]="2"
                [maxFractionDigits]="5" />
            <label for="price">Price</label>
        </p-iftalabel>
        <p-button aria-label="Save record" icon="pi pi-save" pTooltip="Save Contributions"
            tooltipPosition="top" [rounded]="true" [raised]="true" severity="success" size="large"
             />
    </div>
    <ng-template #footer>
        <div class="dialog-flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onEditHoldingCancel()" />
        </div>
    </ng-template>
</p-dialog>